**操作系统原理 实验一**

## 个人信息

【院系】计算机学院

【专业】计算机科学与技术

【学号】22336259

【姓名】谢宇桐

## 实验题目

编译内核/利用已有内核构建OS

## 实验目的

1. 熟悉现有Linux内核的编译过程和启动过程， 并在自行编译内核的基础上构建简单应用并启动。
2. 利用精简的Busybox工具集构建简单的OS， 熟悉现代操作系统的构建过程。
3. 熟悉编译环境、相关工具集，并能够实现内核远程调试。

## 实验要求

1. 搭建 OS 内核开发环境包括：代码编辑环境、编译环境、运行环境、调试环境等。
2. 下载并编译 i386（32位）内核，并利用 qemu 启动内核。
3. 熟悉制作 initramfs 的方法。
4. 编写简单应用程序随内核启动运行。
5. 编译i386版本的 Busybox，随内核启动，构建简单的 OS 。
6. 开启远程调试功能，进行调试跟踪代码运行。
7. 撰写实验报告。

## 实验方案

（此部分需补充完整）

1.虚拟机配置

安装虚拟机软件和对应虚拟机的镜像文件，按教程配置对应工具，用以下命令

`sudo apt install #+对应文件`

`sudo` 是linux系统管理指令，允许普通用户执行一些 root 命令的一个工具。而`apt`提供了查找、安装、升级、删除软件包的命令。`install`代表安装。此命令需要联网

2.编译linux内核

下载linux内核，将内核编译成i386 32位版本。其中用到`make defconfig` 以及 `make menuconfig`命令。前者相当于默认配置，无需作出选择。但开发者总有修改配置的需求，于是后者可以修改特定的配置项。选择Compile-time checks and compiler options，为了让内核可调试。然后编译

3.启动内核并调试

在此步启动qemu启动内核并开启远程调试，qemu是一个模拟处理器软件，并用gdb输入以下命令进行调试：

`gdb`

`file linux-5.10.210/vmlinux #加载符号表将程序中的地址解析为符号名称，以便在调试过程中进行源代码定位和变量查看。`

`target remote:1234 #连接启动的qemu进行调试` 

`break start_kernel #为函数设置断点，使代码运行到此结束`

`c #运行`

最终以Kernel panic结束。

3.制作initramfs

initramfs是个临时的文件系统。制作一个最简单的hello world initramfs。将程序保存在对应位置并打包、加载，再用gdb调试，可以看见输出

4.编译并启动busybox

下载busybox并安装，用`make defconfig`和`make menuconfig`进入设置，按照教程进行配置，并制作initramfs加载busybox

包括：硬件或虚拟机配置方法、软件工具与作用、方案的思想、相关原理、程序流程、算法和数据结构、程序关键模块，结合代码与程序中的位置位置进行解释。不得抄袭，否则按作弊处理。

## 实验过程

1.虚拟机配置

我之前已经配置好了VMware，在官网上找到Ubuntu18.04版本的镜像文件后映射到VMware中安装好虚拟机。

![1710078065313](./image/1710078065313.png)

并按教程配置了C/C++环境以及其他工具

![1710079045458](./image/1710079045458.png)

2.编译linux内核

在找linux版本时只发现了5.10.210。之前已编译成功，因为当时编译成功后没截图，所以只放如下符号表和镜像生成截图

![1710079251282](./image/1710079251282.png)

![1710079433936](./image/1710079433936.png)

3.制作initramfs

启用qemu，编辑hello world文档进lab1，打包并加载qemu，调试gdb，得（输出在第三行）

![1710079750790](./image/1710079750790.png)

4.编译并启动busybox

按照教程调试好后，加载busybox

![1710080027758](./image/1710080027758.png)

输入ls查看当前文件夹

![1710080100543](./image/1710080100543.png)

包括：主要工具安装使用过程及截图结果、程序过程中的操作步骤、测试数据、输入及输出说明、遇到的问题及解决情况、关键功能或操作的截图结果。不得抄袭，否则按作弊处理。

## 实验总结

整体来说这次实验比较顺利，但也遇到了一些困难。在刚开始时看不懂实验教程以为很难，不知道这些代码要输在哪里、代表什么意思。在问了同学后自己耐心仔细看才发现没有很难，只要跟着教程做就可以。因为之前装过虚拟机，所以安装虚拟机比较顺利，再找Ubuntu镜像文件时时没找到5.10.19，装了5.10.210，并把后面代码对应版本号换过来就行（就是比较麻烦，忘记换了就报错）。我也没有进行换源，开始以为换源是在下载Ubuntu之前换，已经下载完了就不用换了，就直接进行了后续步骤，怕再次换源会重置配置，不知道不换源对后续是否有影响。最大的问题就是安装工具安装不上vscode，虚拟机中的应用商店因为网络问题安装不上，网页也打不开，后面查了网上教程才一步步安装好了。在找符号表时遇到了和群里同学一样的问题，明明已安装好但terminal里的命令行找不到，老师解答后才知道要进到对应文件找，若是默认状态下terminal的命令只会在桌面上进行查找，不会深入。编译内核时比较慢，在调试qemu、gdb和busybox时比较麻烦，但没有问题。

实验中其实有很多代码不懂，也不懂教程为何这么调试，一步步在网上查询才大概知道其中的大概原理，这里原理大多晦涩难懂，需要详细解释和一步步搜索才能知晓大概。在此实验中懂了一些命令的作用和用法，希望接下来的实验也能像这次一样顺利。

每人必需写一段，文字不少于500字，可以写心得体会、问题讨论与思考、新的设想、感言总结或提出建议等等。不得抄袭，否则按作弊处理。